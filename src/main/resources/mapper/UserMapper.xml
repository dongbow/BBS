<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.ifxcode.bbs.dao.UserDao">
	<resultMap id="BaseUser" type="User">
		<association property="userAccess" javaType="UserAccess">
			<id column="user_id" property="userId" jdbcType="BIGINT" />
			<result column="user_name" property="userName" jdbcType="VARCHAR" />
			<result column="user_nickname" property="userNickname" jdbcType="VARCHAR" />
			<result column="user_password" property="userPassword" jdbcType="VARCHAR" />
			<result column="user_email" property="userEmail" jdbcType="VARCHAR" />
			<result column="user_reg_ip" property="userRegIp" jdbcType="VARCHAR" />
			<result column="user_is_online" property="userIsOnline" jdbcType="INTEGER" />
			<result column="user_Is_Locked" property="userIsLocked" jdbcType="INTEGER" />
			<result column="user_is_speak" property="userIsSpeak" jdbcType="INTEGER" />
			<result column="user_lastest_login_time" property="userLastestLoginTime" jdbcType="VARCHAR" />
			<result column="user_lastest_login_ip" property="userLastestLoginIp" jdbcType="VARCHAR" />
			<result column="user_create_time" property="userCreateTime" jdbcType="VARCHAR" />
			<result column="user_is_admin" property="userIsAdmin" jdbcType="INTEGER" />
			<result column="user_is_boder_manager" property="userIsBoderManager" jdbcType="INTEGER" />
			<result column="user_is_delete" property="userIsDelete" jdbcType="INTEGER" />
		</association>
		<collection property="roles" ofType="Role">
			<id column="role_id" property="roleId" jdbcType="INTEGER"/>
			<result column="role_name" property="roleName" jdbcType="VARCHAR"/>
			<result column="role_color" property="roleColor" jdbcType="VARCHAR"/>
			<result column="role_desc" property="roleDesc" jdbcType="VARCHAR"/>
			<result column="role_status" property="roleStatus" jdbcType="VARCHAR"/>
			<result column="role_create_time" property="roleCreateTime" jdbcType="VARCHAR"/>
		</collection>
	</resultMap>

	<select id="authLogin" resultMap="BaseUser">
		select ua.*, r.* 
		from user_access as ua, role as r, user_role as ur 
		where user_name = #{name} and user_password = #{password} 
		and user_is_admin = 1 
		and user_is_delete = 0 
		and user_is_locked = 0 
		and ua.user_id = ur.user_id
		and r.role_id = ur.role_id;
	</select>
	 
	<select id="valueCheck" resultType="Integer">
		select count(*) from user_access where ${type} = #{value}
	</select>

</mapper>